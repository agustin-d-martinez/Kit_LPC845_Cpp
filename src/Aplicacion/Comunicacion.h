/*******************************************************************************************************************************//**
 *
 * @file		Comunicacion.h
 * @brief		Clase m치quina de estados de comunicaci칩n del proyecto.
 * @date		23 nov. 2022
 * @author		Grupo 4
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MODULO
 **********************************************************************************************************************************/
#ifndef COMUNICACION_H_
#define COMUNICACION_H_

/***********************************************************************************************************************************
 *** INCLUDES GLOBALES
 **********************************************************************************************************************************/
#include "tipos.h"
#include "Drivers.h"
#include <vector>
#include <stdlib.h>     /* atoi */
#include "string.h"		/* strlen , strcmp , strchr */
/***********************************************************************************************************************************
 *** DEFINES GLOBALES
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS GLOBALES
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPO DE DATOS GLOBALES
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** IMPLANTACION DE UNA CLASE
 **********************************************************************************************************************************/

class Comunicacion
{
	private:
		enum estados { E_VERDE , E_AMARILLO , E_ROJO , E_NADA};

	private:
		UART * 	m_com;
		Reloj	m_reloj;
		vector <uint32_t > &m_msg;					//Vector compartido con las dem치s m치quinas de estado (y por donde se mandan mensajes)

		enum estados m_Estado ;
		void (Comunicacion::*m_maquina[4]) (void);

		uint8_t m_ultimo_msg;
		int8_t	m_hora[15];

	public:
		Comunicacion( UART * _com , vector <uint32_t > &msg );
		~Comunicacion();
		void Transmitir ( char * text );
		void Transmitir ( char * text , int32_t n);
		void MaquinaDeEstados ( void );

	private:	//Maquina de estado
		void Verde( void );
		void Amarillo( void );
		void Rojo( void );
		void Nada( void );
		void revisarRx( void );
		void intToStr(int32_t num, int8_t* str);

};
#endif /* COMUNICACION_H_ */
