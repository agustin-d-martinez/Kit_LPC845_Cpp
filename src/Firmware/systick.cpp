/*******************************************************************************************************************************//**
 *
 * @file		systick.cpp
 * @brief		Firmware del systick.
 * @details
 *
 * @date		20 abr. 2022
 * @version		2.0
 * @author     	Marcelo y TÃ©cnico. Martinez Agustin (masteragus365@gmail.com)
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "systick.h"
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/
/** MAX ticks of SYSTICK clock. */
#define MAX_TICKS 	0xffffff
/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
uint32_t g_systick_freq = 0;
/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** IMPLEMENTACION DE LOS METODODS DE LA CLASE
 **********************************************************************************************************************************/
/**
	\fn void SysTick_Handler( void )
	\brief Funcion handler de todos los systick
*/
void SysTick_Handler( void )
{
	if (!g_Handler.empty())
	{
		for (Callback* q : g_Handler )
			q->SWhandler();
	}
}
/**
	\fn uint32_t Inicializar_SysTick( uint32_t freq )
	\brief Inicializa el systick en la frecuencia asignada.
	\param  [in] freq: ticks por segundo.
	\return mensaje de error
*/
uint32_t Inicializar_SysTick( uint32_t freq )
{
	uint32_t ticks = FREQ_PRINCIPAL/freq;
	g_systick_freq = freq;
	if (ticks > MAX_TICKS)
		return 1 ;          	//* Reload value imp	ossible

	SysTick->RELOAD = ticks - 1;  //* set reload register

	SysTick->CURR = 0;           //* Load the SysTick Counter Value

	SysTick->CTRL = 7;

	return 0;
}
